<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ Administration</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="../../shared/css/theme.css">
    <link rel="stylesheet" href="../../shared/css/navigation.css">
    <link rel="stylesheet" href="../../shared/css/page-header.css">
    <link rel="stylesheet" href="../../shared/css/modals.css">
    <link rel="stylesheet" href="css/admin-styles.css">
</head>
<body>
    <div class="container">
        <!-- Header injectÃ© par PageHeader.render() -->

        <!-- Onglets de navigation admin -->
        <nav class="admin-tabs">
            <button class="admin-tab-btn active" data-tab="users">ğŸ‘¥ Utilisateurs</button>
            <button class="admin-tab-btn" data-tab="themes">ğŸ¨ ThÃ¨mes</button>
            <button class="admin-tab-btn" data-tab="cards">ğŸƒ Cartes</button>
            <button class="admin-tab-btn" data-tab="word-search">ğŸ” Mots MÃªlÃ©s</button>
            <button class="admin-tab-btn" data-tab="ratings">ğŸ“Š Notations</button>
            <button class="admin-tab-btn" data-tab="import">ğŸ“¥ Import V1</button>
        </nav>

        <main class="admin-content">
            <!-- Section Utilisateurs -->
            <section id="users-section" class="admin-section active">
                <div class="section-header">
                    <h2>ğŸ‘¥ Gestion des Utilisateurs</h2>
                    <button id="create-user-btn" class="admin-btn-primary">â• CrÃ©er un compte</button>
                </div>
                <div class="users-search">
                    <input type="text" id="users-search-input" placeholder="ğŸ” Rechercher par nom ou email..." autocomplete="search-users-filter">
                </div>
                <div class="users-list" id="users-list">
                    <!-- Liste des utilisateurs chargÃ©e dynamiquement -->
                </div>
            </section>

            <!-- Section ThÃ¨mes -->
            <section id="themes-section" class="admin-section">
                <div class="section-header">
                    <h2>ğŸ¨ Gestion des ThÃ¨mes</h2>
                    <button id="create-theme-btn" class="admin-btn-primary">â• Nouveau thÃ¨me</button>
                </div>

                <div id="themes-container">
                    <!-- Liste des thÃ¨mes chargÃ©e dynamiquement -->
                </div>
            </section>

            <!-- Section Cartes -->
            <section id="cards-section" class="admin-section">
                <div class="section-header">
                    <h2>ğŸƒ Gestion des Cartes</h2>
                    <div class="section-actions">
                        <button id="toggle-all-themes-btn" class="admin-btn-secondary" title="Tout replier/dÃ©plier">
                            ğŸ“¦ Tout replier
                        </button>
                    </div>
                </div>

                <div class="cards-filters">
                    <select id="cards-rarity-filter">
                        <option value="">Toutes les raretÃ©s</option>
                        <option value="common">ğŸ¤ Commune</option>
                        <option value="rare">ğŸ’™ Rare</option>
                        <option value="very_rare">ğŸ’š TrÃ¨s Rare</option>
                        <option value="epic">ğŸ’› Ã‰pique</option>
                        <option value="legendary">â¤ï¸ LÃ©gendaire</option>
                    </select>
                </div>

                <div id="cards-by-theme-container">
                    <!-- Cartes groupÃ©es par thÃ¨me chargÃ©es dynamiquement -->
                </div>
            </section>

            <!-- Section Mots MÃªlÃ©s -->
            <section id="word-search-section" class="admin-section">
                <div class="section-header">
                    <h2>ğŸ” Gestion des Mots MÃªlÃ©s</h2>
                </div>

                <div class="words-search">
                    <input type="text" id="words-search-input" placeholder="ğŸ” Rechercher un mot..." autocomplete="off">
                </div>

                <div id="word-themes-container">
                    <!-- ThÃ¨mes et leurs mots chargÃ©s dynamiquement -->
                </div>
            </section>

            <!-- Section Notations -->
            <section id="ratings-section" class="admin-section">
                <div class="section-header">
                    <h2>ğŸ“Š Statistiques de Notation</h2>
                    <p style="color: #8a8aa8;">Analyse de l'intÃ©rÃªt et de la difficultÃ© des jeux par tranche d'Ã¢ge</p>
                </div>

                <div id="ratings-stats-container">
                    <!-- Statistiques chargÃ©es dynamiquement -->
                    <div class="loading">Chargement des statistiques...</div>
                </div>
            </section>

            <!-- Section Import V1 -->
            <section id="import-section" class="admin-section">
                <div class="section-header">
                    <h2>ğŸ“¥ Import de Collection V1</h2>
                    <p style="color: #8a8aa8;">Importer une collection depuis la version 1 du jeu</p>
                </div>

                <div class="import-container">
                    <div class="import-instructions">
                        <h3>Instructions :</h3>
                        <ol>
                            <li>Copiez le JSON exportÃ© depuis la v1 du jeu (via l'admin)</li>
                            <li>SÃ©lectionnez l'utilisateur de destination</li>
                            <li>Collez le JSON dans la zone de texte ci-dessous</li>
                            <li>Cliquez sur "Importer la collection"</li>
                        </ol>
                    </div>

                    <div class="form-group">
                        <label for="import-user-select">Utilisateur de destination :</label>
                        <select id="import-user-select" required>
                            <option value="">-- SÃ©lectionner un utilisateur --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="import-json-input">JSON de la collection V1 :</label>
                        <textarea id="import-json-input" rows="15" placeholder='Collez ici le JSON exportÃ© depuis la v1...'></textarea>
                    </div>

                    <div class="import-options">
                        <label>
                            <input type="checkbox" id="import-merge-mode">
                            Mode fusion (ajouter aux cartes existantes)
                        </label>
                        <small style="color: #b0b0b0; margin-top: 8px; display: block;">
                            âš ï¸ Par dÃ©faut, toutes les cartes existantes de l'utilisateur seront supprimÃ©es avant l'import
                        </small>
                    </div>

                    <button id="import-collection-btn" class="admin-btn-primary" disabled>
                        ğŸ“¥ Importer la collection
                    </button>

                    <div id="import-result" class="import-result" style="display: none;"></div>
                </div>
            </section>
        </main>

        <!-- Modal pour crÃ©er/Ã©diter un utilisateur -->
        <div id="user-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="user-modal-close">&times;</span>
                <h2 id="user-modal-title">CrÃ©er un utilisateur</h2>
                <form id="user-form" class="admin-form">
                    <input type="hidden" id="user-id">

                    <div class="form-group">
                        <label for="user-username">Nom d'utilisateur :</label>
                        <input type="text" id="user-username" required>
                    </div>

                    <div class="form-group">
                        <label for="user-email">Email :</label>
                        <input type="email" id="user-email" required>
                    </div>

                    <div class="form-group">
                        <label for="user-birth-date">Date de naissance :</label>
                        <input type="date" id="user-birth-date">
                        <small>UtilisÃ©e pour les statistiques (optionnel)</small>
                    </div>

                    <div class="form-group" id="user-password-group">
                        <label for="user-password">Mot de passe :</label>
                        <input type="password" id="user-password">
                        <small>Laisser vide pour ne pas changer le mot de passe</small>
                    </div>

                    <div class="form-group" id="user-credits-group" style="display: none;">
                        <label for="user-credits-adjustment">Ajuster les crÃ©dits :</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="user-credits-adjustment" value="0" style="width: 150px; text-align: center;" placeholder="Ex: +10 ou -5">
                            <button type="button" class="admin-btn-success" id="user-credits-add-btn">â• Ajouter</button>
                            <button type="button" class="admin-btn-danger" id="user-credits-remove-btn">â– Retirer</button>
                        </div>
                        <small>Valeurs positives pour ajouter, nÃ©gatives pour retirer (ex: 10 ou -5)</small>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="user-is-admin">
                            Administrateur
                        </label>
                    </div>

                    <div class="form-group" id="user-themes-group" style="display: none;">
                        <label>ThÃ¨mes de collection :</label>
                        <small>SÃ©lectionnez les thÃ¨mes que l'utilisateur peut collectionner (min 3, max 10)</small>
                        <div id="user-themes-selector" class="themes-selector-admin">
                            <!-- Les thÃ¨mes seront chargÃ©s dynamiquement -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="admin-btn-primary">ğŸ’¾ Enregistrer</button>
                        <button type="button" id="user-form-cancel" class="admin-btn-secondary">Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal pour crÃ©er/Ã©diter une carte -->
        <div id="card-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="card-modal-close">&times;</span>
                <h2 id="card-modal-title">CrÃ©er une carte</h2>
                <form id="card-form" class="admin-form">
                    <input type="hidden" id="card-id">

                    <div class="form-group">
                        <label for="card-name">Nom de la carte :</label>
                        <input type="text" id="card-name" required>
                    </div>

                    <div class="form-group">
                        <label for="card-description">Description :</label>
                        <textarea id="card-description" rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="card-theme">ThÃ¨me :</label>
                        <select id="card-theme" required>
                            <option value="">-- Choisir un thÃ¨me --</option>
                            <option value="minecraft">ğŸŸ« Minecraft</option>
                            <option value="space">ğŸŒŒ Astronomie</option>
                            <option value="dinosaurs">ğŸ¦• Dinosaures</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="card-rarity">RaretÃ© :</label>
                        <select id="card-rarity" required>
                            <option value="">-- Choisir une raretÃ© --</option>
                            <option value="common">ğŸ¤ Commune (60%)</option>
                            <option value="rare">ğŸ’™ Rare (25%)</option>
                            <option value="very_rare">ğŸ’š TrÃ¨s Rare (10%)</option>
                            <option value="epic">ğŸ’› Ã‰pique (4%)</option>
                            <option value="legendary">â¤ï¸ LÃ©gendaire (1%)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="card-image">Chemin de l'image :</label>
                        <input type="text" id="card-image" required placeholder="images/nom_fichier.ext" autocomplete="new-password">
                        <small>Chemin relatif (ex: images/card.png) ou URL complÃ¨te</small>
                    </div>

                    <div class="form-group">
                        <label>AperÃ§u de l'image :</label>
                        <div class="card-preview">
                            <img id="card-preview-img" src="" alt="AperÃ§u" style="display: none;">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="admin-btn-primary">ğŸ’¾ Enregistrer</button>
                        <button type="button" id="card-form-cancel" class="admin-btn-secondary">Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal pour crÃ©er/Ã©diter un thÃ¨me -->
        <div id="theme-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="theme-modal-close">&times;</span>
                <h2 id="theme-modal-title">CrÃ©er un thÃ¨me</h2>
                <form id="theme-form" class="admin-form">
                    <input type="hidden" id="theme-id">

                    <div class="form-group">
                        <label for="theme-slug">Identifiant (slug) :</label>
                        <input type="text" id="theme-slug" required pattern="[a-z0-9_\-]+" placeholder="ex: chateaux">
                        <small>Lettres minuscules (sans accents), chiffres, tirets et underscores uniquement</small>
                    </div>

                    <div class="form-group">
                        <label for="theme-name">Nom du thÃ¨me :</label>
                        <input type="text" id="theme-name" required placeholder="ex: ChÃ¢teaux">
                        <small>Nom affichÃ© (accents autorisÃ©s)</small>
                    </div>

                    <div class="form-group">
                        <label for="theme-icon">IcÃ´ne (emoji) :</label>
                        <input type="text" id="theme-icon" required maxlength="2" placeholder="ex: ğŸ¦•">
                        <small>Choisissez un emoji reprÃ©sentant le thÃ¨me</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="admin-btn-primary">ğŸ’¾ Enregistrer</button>
                        <button type="button" id="theme-form-cancel" class="admin-btn-secondary">Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal pour crÃ©er/Ã©diter un mot -->
        <div id="word-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="word-modal-close">&times;</span>
                <h2 id="word-modal-title">Ajouter un mot</h2>
                <form id="word-form" class="admin-form">
                    <input type="hidden" id="word-id">
                    <input type="hidden" id="word-theme-ref">

                    <div class="form-group">
                        <label for="word-text">Mot :</label>
                        <input type="text" id="word-text" required placeholder="ex: CREEPER" style="text-transform: uppercase;" pattern="[A-ZÃ€-Ã¿\s]+" maxlength="15">
                        <small>Uniquement des lettres majuscules (3-15 caractÃ¨res)</small>
                    </div>

                    <div class="form-group">
                        <label for="word-definition">DÃ©finition (pour les mots croisÃ©s) :</label>
                        <textarea id="word-definition" rows="3" placeholder="ex: CrÃ©ature explosive qui dÃ©truit les constructions"></textarea>
                        <small>DÃ©finition utilisÃ©e comme indice dans les mots croisÃ©s</small>
                    </div>

                    <div class="form-group">
                        <label for="word-theme">ThÃ¨me (optionnel) :</label>
                        <select id="word-theme">
                            <option value="">-- Mot gÃ©nÃ©rique (pour tous) --</option>
                            <!-- Les thÃ¨mes seront chargÃ©s dynamiquement -->
                        </select>
                        <small>Les mots gÃ©nÃ©riques sont disponibles pour tous les joueurs. Les mots liÃ©s Ã  un thÃ¨me ne sont disponibles que pour les joueurs ayant ce thÃ¨me.</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="admin-btn-primary">ğŸ’¾ Enregistrer</button>
                        <button type="button" id="word-form-cancel" class="admin-btn-secondary">Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast pour les notifications -->
        <div id="toast" class="toast"></div>
    </div>

    <!-- Scripts communs -->
    <script src="../../shared/js/common.js"></script>
    <!-- Admin scripts -->
    <script src="js/admin-ui.js"></script>
    <script src="js/admin-users.js"></script>
    <script src="js/admin-themes.js"></script>
    <script src="js/admin-cards.js"></script>
    <script src="js/admin-word-search.js"></script>
    <script src="js/admin-ratings.js"></script>
    <script src="js/admin-import.js"></script>
    <script src="js/admin-app.js"></script>

    <!-- Auth initialization -->
    <script>
        window.onCommonScriptsLoaded = () => initializeApp(() => initAdminPanel(), {requireAdmin: true});
    </script>
</body>
</html>
